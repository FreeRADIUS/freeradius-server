#  -*- text -*-
#
#
#  $Id$

#######################################################################
#
#  = DHCP SQL-IP-Pool Module
#
#  The module `dhcp_sqlippool` provides configuration for `DHCP` to use `SQL IP Pools`.
#
#  [NOTE]
#  ====
#  * See the `raddb/policy.d/dhcp_sqlippool` for the "glue" code that allows
#  the RADIUS based `sqlippool` module to be used for DHCP.
#  * See `raddb/sites-available/dhcp` for instructions on how to configure the DHCP server.
#  ====
#
#  ## Configuration Settings
sqlippool dhcp_sqlippool {
	#
	#  SQL instance to use (from mods-available/sql)
	#
	#  If you have multiple sql instances such as "sql sql1 {...}",
	#  use the *instance* name here: sql1
	sql_module_instance = "sql"

	#  This should be set the same as the dialect for the SQL
	#  instance in use
	dialect = "postgresql"

	#  SQL table name to use for DHCP ip pools
	ippool_table = "radippool"

	#  Name of the attribute to be populated with the pool name
	#  to pick addresses from
	pool_name = "Pool-Name"

	#  IP lease duration.  Used to set the expiry time of a lease
	#  in the database in response to DHCP Request
	lease_duration = 7200

	#  How long to hold leases in the database between a Discover
	#  and Request.  Setting this short prevents the pool being
	#  exhausted by clients sending Discovers but never Reqiests.
	offer_duration = 5

	#
	#  RFC 2132 allows the DHCP client to supply a unique
	#  identifier ("uid") using Option 61 (DHCP-Client-Identifier)
	#  in which case it must be used as the lookup key for
	#  configuration data.
	#
	pool_key = "%{%{DHCP-Client-Identifier}:-%{DHCP-Client-Hardware-Address}}"
	#
	#  The "uid" is generated by the OS which means that clients
	#  whose BMC piggybacks on the main interface (sharing its MAC,
	#  but generating a distinct uid) and dual-booting clients can
	#  be allocated multiple IPs, consuming more pool entries. To
	#  avoid this you can ignore the RFCs and key the configuration
	#  data based only on the client MAC address.
	#
	#  pool_key = "%{DHCP-Client-Hardware-Address}"

	#  The attribute in which the IP address is returned in the reply
	attribute_name = "DHCPv4.DHCP-Your-IP-Address"

	#  The attribute in which a requested IP address is received
	req_attribute_name = "DHCPv4.DHCP-Requested-IP-Address"

	#
	#  Load queries for the relevant SQL version
	#
	$INCLUDE ${modconfdir}/sql/ippool-dhcp/${dialect}/queries.conf

	sqlippool_log_exists = "DHCP: Existing IP: %{reply:${attribute_name}} (did %{Called-Station-Id} cli %{Calling-Station-Id} port %{NAS-Port} user %{User-Name})"

	sqlippool_log_success = "DHCP: Allocated IP: %{reply:${attribute_name}} from %{control:Pool-Name} (did %{Called-Station-Id} cli %{Calling-Station-Id} port %{NAS-Port} user %{User-Name})"

	sqlippool_log_clear = "DHCP: Released IP %{${attribute_name}} (did %{Called-Station-Id} cli %{Calling-Station-Id} user %{User-Name})"

	sqlippool_log_failed = "DHCP: IP Allocation FAILED from %{control:Pool-Name} (did %{Called-Station-Id} cli %{Calling-Station-Id} port %{NAS-Port} user %{User-Name})"

	sqlippool_log_nopool = "DHCP: No Pool-Name defined (did %{Called-Station-Id} cli %{Calling-Station-Id} port %{NAS-Port} user %{User-Name})"
}
