#  -*- text -*-
#
#  This is a simple server for the MS SoH requests generated by the
#  peap module - see "raddb/mods-available/eap" for more info
#
#  Requests are ONLY passed through the authorize section, and cannot
#  current be proxied (in any event, the radius attributes used are
#  internal).
#
#	$Id$
#

server soh-server {
	recv Access-Request {
		if (&SoH-Supported == no) {
			#  client NAKed our request for SoH - not supported, or turned off
			&control.Auth-Type = Accept
		}
		else {
			#  client replied; check something - this is a local policy issue!
			if (&SoH-MS-Windows-Health-Status =~ /antivirus (warn|error) /) {
				&control.Auth-Type = Reject
				&reply.Reply-Message = "You must have antivirus enabled & installed!"
			}
			else {
				&control.Auth-Type = Accept
			}
		}
	}
}
