= Other protocols within RADIUS: EAP-MD5

*Goal:* To configure the server to use the EAP-MD5 authentication
protocol and to send and receive test packets.

*Time:* 10-15 minutes.

*File:*

- `mods-available/eap`
- `mods-config/files/authorize`
- `sites-enabled/default`
- `eapol_test.conf`

== Overview: What Is EAP-MD5?

`EAP` (Extensible Authentication Protocol) is a wrapper — it carries other authentication protocols inside it. Think of it like an envelope: the envelope itself doesn't contain the message, it just delivers it. `EAP-MD5` is one of the protocols that gets carried inside that envelope.

When a client wants to authenticate, the server doesn't ask for a password directly. Instead it sends a random challenge, and the client responds with an MD5 hash of that challenge combined with their password. The server runs the same calculation and checks if the results match. The password never crosses the network — only the hash does.

*Diagram:*

image::eap-md5.svg[Fig. EAP-MD5]

In this setup, `EAP` runs inside RADIUS. Instead of the NAS (a switch or access point), `eapol_test` acts as a relay — it wraps `EAP` packets into RADIUS messages and passes them to FreeRADIUS. The real conversation is always between the client and the FreeRADIUS server.

== Configuration

=== Step 1: Add User "bob"

In `mods-config/files/authorize`, add:

[source, text]
----
bob Password.Cleartext := "hello"
----

=== Step 2: Configure the EAP Module

In `mods-enabled/eap`, set `require_identity_realm = no` since we are not using realm-based authentication:

[source, text]
----
eap {
    require_identity_realm = no
}
----

=== Step 3: Configure the Default Site

In `sites-enabled/default`, add the following sections:

[source, text]
----
recv Access-Request {
    files
    eap {
        ok = return
        updated = return
    }
}

authenticate eap {
    eap
}
----

=== Step 4: Create the eapol_test Config File

Create a file called `eapol_test.conf` with the following content:

[source, text]
----
network={
    key_mgmt=NONE
    eap=MD5
    identity="bob"
    password="hello"
}
----

*Note:* `key_mgmt=NONE` is used here because `EAP-MD5` does not derive encryption keys.

=== Step 5: install the eapol

Make sure to install `eapol_test` before proceeding. This will download, compile, and print the location of the resulting binary.

=== Step 6: Run the Server in Debug Mode

[source, text]
----
$ radiusd -X
----

=== Step 7: Run the Test

[source, bash]
----
$ eapol_test -c eapol_test.conf -a 127.0.0.1 -p 1812 -s testing123 -n
----


== Questions

1.  In which of the following sections is the `eap` module used?
authorize, authenticate, and accounting.
2.  Which of those sections do not reference the `eap`
module? Why?
3.  What is the difference (if any) between the server output for this
test and the diagram below? Why is there a difference?
image::eap_md5.svg[Fig. EAP-MD5]
4.  Why do we test EAP-MD5 before testing other EAP types?
5.  How is the EAP protocol carried within a RADIUS packet?
6.  Why is the Message-Authenticator attribute required when using EAP?
7.  What security issues exist with EAP-MD5?
8.  Why is EAP-MD5 disabled in newer operating systems?

// Copyright (C) 2021 Network RADIUS SAS.  Licenced under CC-by-NC 4.0.
// This documentation was developed by Network RADIUS SAS.
