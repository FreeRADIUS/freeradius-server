#
#  Test vectors for DHCPv6 protocol
#
load dhcpv6
dictionary-load dhcpv6

#
#  Encoding an option header:
#
#   0                   1                   2                   3
#   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#  |        OPTION_CLIENTID        |          option-len           |
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#

#  From RFC 3315
#
#  9.2. DUID Based on Link-layer Address Plus Time [DUID-LLT]
#
#  The following diagram illustrates the format of a DUID-LLT:
#
#   0                   1                   2                   3
#   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#  |               1               |    hardware type (16 bits)    |
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#  |                        time (32 bits)                         |
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#  .                                                               .
#  .             link-layer address (variable length)              .
#  .                                                               .
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#

#
#  Client Identifier
#

#  Define the DUID-LLT + DUID
encode-pair Client-ID-DUID = Client-ID-DUID-LLT, Client-ID-DUID-LLT-Hardware-Type = 1, Client-ID-DUID-LLT-Time = "Jan  1 1970 12:00:00 UTC", Client-ID-DUID-LLT-Ethernet-Address = aa:bb:cc:dd:ee:ff
match 00 01 00 0e 00 01 00 01 00 00 a8 c0 aa bb cc dd ee ff

decode-pair -
match Client-ID-DUID = Client-ID-DUID-LLT, Client-ID-DUID-LLT-Hardware-Type = Client-ID-DUID-LLT-Ethernet, Client-ID-DUID-LLT-Time = "Jan  1 1970 12:00:00 UTC", Client-ID-DUID-LLT-Ethernet-Address = aa:bb:cc:dd:ee:ff

#
#  Server Identifier
#

#  Define the DUID-LLT + DUID
encode-pair Server-ID-DUID = Server-ID-DUID-LLT, Server-ID-DUID-LLT-Hardware-Type = 3, Server-ID-DUID-LLT-Time = "Jan  1 1970 12:00:00 UTC", Server-ID-DUID-LLT-Link-Layer-Address = 0xc0ffeec0ffee
match 00 02 00 0e 00 01 00 03 00 00 a8 c0 c0 ff ee c0 ff ee

decode-pair -
match Server-ID-DUID = Server-ID-DUID-LLT, Server-ID-DUID-LLT-Hardware-Type = 3, Server-ID-DUID-LLT-Time = "Jan  1 1970 12:00:00 UTC", Server-ID-DUID-LLT-Link-Layer-Address = 0xc0ffeec0ffee

#
#  9.3. DUID Assigned by Vendor Based on Enterprise Number [DUID-EN]
#
#   0                   1                   2                   3
#   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#  |               2               |       enterprise-number       |
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#  |   enterprise-number (contd)   |                               |
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               |
#  .                           identifier                          .
#  .                       (variable length)                       .
#  .                                                               .
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#

#
#  Client Identifier
#

#  Define the DUID-EN + DUID
encode-pair Client-ID-DUID = Client-ID-DUID-EN, Client-ID-DUID-EN-Enterprise-Number = 11344, Client-ID-DUID-EN-Identifier = 0xaabbccddeeff
match 00 01 00 0c 00 02 00 00 2c 50 aa bb cc dd ee ff

decode-pair -
match Client-ID-DUID = Client-ID-DUID-EN, Client-ID-DUID-EN-Enterprise-Number = 11344, Client-ID-DUID-EN-Identifier = 0xaabbccddeeff

#
#  Server Identifier
#

#  Define the DUID-EN + DUID
encode-pair Server-ID-DUID = Server-ID-DUID-EN, Server-ID-DUID-EN-Enterprise-Number = 11344, Server-ID-DUID-EN-Identifier = 0xc0ffeec0ffee
match 00 02 00 0c 00 02 00 00 2c 50 c0 ff ee c0 ff ee

decode-pair -
match Server-ID-DUID = Server-ID-DUID-EN, Server-ID-DUID-EN-Enterprise-Number = 11344, Server-ID-DUID-EN-Identifier = 0xc0ffeec0ffee

#
#  9.4. DUID Based on Link-layer Address [DUID-LL]
#
#   0                   1                   2                   3
#   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#  |               3               |    hardware type (16 bits)    |
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#  .                                                               .
#  .             link-layer address (variable length)              .
#  .                                                               .
#  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
#

#
#  Client Identifier
#

#  Define the DUID-LL + DUID
encode-pair Client-ID-DUID = Client-ID-DUID-LL, Client-ID-DUID-LL-Hardware-Type = 2, Client-ID-DUID-LL-Address = 0xaabbccddeeff
match 00 01 00 0a 00 03 00 02 aa bb cc dd ee ff

decode-pair -
match Client-ID-DUID = Client-ID-DUID-LL, Client-ID-DUID-LL-Hardware-Type = 2, Client-ID-DUID-LL-Address = 0xaabbccddeeff

#
#  Server Identifier
#

#  Define the DUID-LL + DUID
encode-pair Server-ID-DUID = Server-ID-DUID-LL, Server-ID-DUID-LL-Hardware-Type = 2, Server-ID-DUID-LL-Address = 0xd34d00c0ffee
match 00 02 00 0a 00 03 00 02 d3 4d 00 c0 ff ee

decode-pair -
match Server-ID-DUID = Server-ID-DUID-LL, Server-ID-DUID-LL-Hardware-Type = 2, Server-ID-DUID-LL-Address = 0xd34d00c0ffee

#
#  1 byte unsigned integer (uint8)
#
encode-pair Preference = 255
match 00 07 00 01 ff

encode-pair Preference = 0
match 00 07 00 01 00

#
#  empty value. (only signal)
#
encode-pair Rapid-Commit = 0x
match 00 0e 00 00

decode-pair -
match Rapid-Commit = 0x

#
#  Encode ipv6address
#
encode-pair Unicast = 2001:0db8:85a3:0000:0000:8a2e:0370:7334
match 00 0c 00 10 20 01 0d b8 85 a3 00 00 00 00 8a 2e 03 70 73 34

# Scope should be ignored.  We use %0 as numbered scopes work everywhere, interfaces don't
encode-pair Unicast = 2001:0db8:85a3:0000:0000:8a2e:0370:7334%0
match 00 0c 00 10 20 01 0d b8 85 a3 00 00 00 00 8a 2e 03 70 73 34

#
#  Variable length octets array
#
encode-pair User-Class = 0x010203, User-Class = 0x02040810
match 00 0f 00 0b 00 03 01 02 03 00 04 02 04 08 10

encode-pair User-Class = 0x010203
match 00 0f 00 05 00 03 01 02 03

encode-pair User-Class = 0x, User-Class = 0x
match 00 0f 00 04 00 00 00 00

count
match 44
