# PRE: update if foreach
#
#  Redundant blocks.
#
#  The first one fails, so the second one is used
#
&request.Tmp-Integer-0 := 0
&request.Tmp-Integer-1 += 0
&request.Tmp-Integer-1 += 1
&request.Tmp-Integer-1 += 2
&request.Tmp-Integer-1 += 3
&request.Tmp-Integer-1 += 4
&request.Tmp-Integer-1 += 5
&request.Tmp-Integer-1 += 6
&request.Tmp-Integer-1 += 7
&request.Tmp-Integer-1 += 8
&request.Tmp-Integer-1 += 9

redundant {
	group {
		fail
	}

	group {
		success
	}
}

if (!&reply.Result-Status) {
	test_fail
}

#
#  Loop 0..9
#
foreach &request.Tmp-Integer-1 {
	redundant {
		group {
			# fail on even numbered values, succeed on odd numbered ones
			if ("%{expr:%{Foreach-Variable-0} % 2}" == 0) {
				fail
			}
			else {
				&request.Tmp-Integer-0 := "%{expr:%{request.Tmp-Integer-0} + 1}"
				&request.Filter-Id += "SUCCEED ODD %{Foreach-Variable-0} %{request.Tmp-Integer-0}"
				ok
			}
		}
		group {
			# succeed on even-numbered values, fail on off-numbered ones.
			if ("%{expr:%{Foreach-Variable-0} % 2}" == 1) {
				fail
			}
			else
				&request.Tmp-Integer-0 := "%{expr:%{request.Tmp-Integer-0} + 1}"
				&Filter-Id += "SUCCEED EVEN %{Foreach-Variable-0} %{request.Tmp-Integer-0}"
				ok
			}
		}
	}
}

if (&request.Tmp-Integer-0 != "%{request.Tmp-Integer-1[#]}") {
    test_fail
}
else {
	success
}
