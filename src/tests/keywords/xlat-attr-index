#
# PRE: update
#

&request.Tmp-IP-Address-0 := 192.0.2.1
&request.Tmp-IP-Address-0 += 192.0.2.2

if ("%{request.Tmp-IP-Address-0[#]}" != 2) {
	test_fail
}

if (("%{request.Tmp-IP-Address-0[0]}" != 192.0.2.1) || ("%{request.Tmp-IP-Address-0[1]}" != 192.0.2.2)) {
	test_fail
}

if ("%{request.Tmp-IP-Address-0[*]}" != '192.0.2.1192.0.2.2') {
	test_fail
}

# Try calling these xlats in mapping too, they may get optimised to VPTs which is a
# different code path.
&request.Tmp-IP-Address-1 += "%{request.Tmp-IP-Address-0[1]}"
&request.Tmp-IP-Address-1 += "%{request.Tmp-IP-Address-0[0]}"
&request.Tmp-String-0 = "%(concat:%{request.Tmp-IP-Address-0[*]} ,)"
&request.Tmp-Integer-0 = "%{request.Tmp-IP-Address-0[#]}"

if (&request.Tmp-String-0 != '192.0.2.1,192.0.2.2') {
	test_fail
}

if (&request.Tmp-Integer-0 != 2) {
	test_fail
}

success
