#
# PRE: update if
#
# Some encoders replace ~ with %7E RFC3986 Section 2.4 says this should not be done.
&request.Tmp-String-0 := '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_.~'
&request.Tmp-String-2 := '±§!@#$%^&*()+={[}]:;"\'|\<,>?/`'
&request.Tmp-String-4 := '™œ¥¤'
&request.Tmp-String-6 := '%C2%B1%C2%A7%21%40%23%24%25%5E%26%2A%28%29%2B%3D%7B%5B%7D%5D%3A%3B%22%27%7C%5C%3C%2C%3E%3F%2F%60'
&request.Tmp-String-8 := '%E2%84%A2%C5%93%C2%A5%C2%A4'

&request.Tmp-String-1 := "%{urlquote:%{request.Tmp-String-0}}"
&request.Tmp-String-3 := "%{urlquote:%{request.Tmp-String-2}}"
&request.Tmp-String-5 := "%{urlquote:%{request.Tmp-String-4}}"
&request.Tmp-String-7 := "%{urlunquote:%{request.Tmp-String-6}}"
&request.Tmp-String-9 := "%{urlunquote:%{request.Tmp-String-8}}"


if (&request.Tmp-String-1 != &request.Tmp-String-0) {
	test_fail
}

if (&request.Tmp-String-3 != &request.Tmp-String-6) {
	test_fail
}

if (&request.Tmp-String-5 != &request.Tmp-String-8) {
	test_fail
}

if (&request.Tmp-String-7 != &request.Tmp-String-2) {
	test_fail
}

if (&request.Tmp-String-9 != &request.Tmp-String-4) {
	test_fail
}

&request.Tmp-String-1 := "%{urlunquote:%{request.Tmp-String-0}}"
&request.Tmp-String-2 := "%{urlunquote:%%E,123}"

if (&request.Tmp-String-1 != &request.Tmp-String-0) {
	test_fail
}

# Test decoding invalid encoded string
if (&request.Tmp-String-2 != "") {
	test_fail
}

success
