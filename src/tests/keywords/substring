#
# PRE: update
#
#  Check substring xlat works correctly
#
update {
	&control.Cleartext-Password := 'hello'
	&reply.Filter-Id := 'filter'
}

update request {
	&Tmp-String-0      := 'foo bar'
	&Tmp-Integer-0     := 54786512
	&Tmp-IP-Address-0  := 192.168.56.34
	&Tmp-Ethernet-0    := 01:23:45:67:89:ab
}

update request {
	&Tmp-String-1 := "%{substring:&Tmp-String-0 2 3}"
	&Tmp-String-2 := "%{substring:&Tmp-String-0 -3 3}"
	&Tmp-String-3 := "%{substring:&Tmp-String-0 1 -3}"
	&Tmp-String-4 := "%{substring:&Tmp-String-0 -4 -1}"
	&Tmp-String-5 := "%{substring:&Tmp-String-0 8 5}"
	&Tmp-String-6 := "%{substring:&Tmp-String-0 4 -10}"
	&Tmp-String-7 := "%{substring:&Tmp-String-0 0 7}"
	&Tmp-String-8 := "%{substring:&Tmp-String-0 3 0}"
	&Tmp-String-9 := "%{substring:&Tmp-String-0 4 8}"
}

if (&Tmp-String-1 != 'o b') {
	test_fail
}

if (&Tmp-String-2 != 'bar') {
	test_fail
}

if (&Tmp-String-3 != 'oo ') {
	test_fail
}

if (&Tmp-String-4 != ' ba') {
	test_fail
}

if (&Tmp-String-5 != '') {
	test_fail
}

if (&Tmp-String-6 != '') {
	test_fail
}

if (&Tmp-String-7 != 'foo bar') {
	test_fail
}

if (&Tmp-String-8 != '') {
	test_fail
}

if (&Tmp-String-9 != 'bar') {
	test_fail
}

update request {
	&Tmp-String-0      := ' foo bar '
}

update request {
	&Tmp-String-1 := "%{substring: &Tmp-String-0 2 3}"
	&Tmp-String-2 := "%{substring:&Tmp-String-0 -3 3}"
	&Tmp-String-3 := "%{substring:&Tmp-String-0 1 -3}"
	&Tmp-String-4 := "%{substring:&Tmp-String-0 -4 -1}"
	&Tmp-String-5 := "%{substring:&Tmp-String-0 10 5}"
	&Tmp-String-6 := "%{substring:&Tmp-String-0 4 -10}"
	&Tmp-String-7 := "%{substring:&Tmp-String-0 0 9}"
	&Tmp-String-8 := "%{substring:&Tmp-String-0 3 0}"
	&Tmp-String-9 := "%{substring:&Tmp-String-0 4 10}"
}

if (&Tmp-String-1 != 'oo ') {
	test_fail
}

if (&Tmp-String-2 != 'ar ') {
	test_fail
}

if (&Tmp-String-3 != 'foo b') {
	test_fail
}

if (&Tmp-String-4 != 'bar') {
	test_fail
}

if (&Tmp-String-5 != '') {
	test_fail
}

if (&Tmp-String-6 != '') {
	test_fail
}

if (&Tmp-String-7 != ' foo bar ') {
	test_fail
}

if (&Tmp-String-8 != '') {
	test_fail
}

if (&Tmp-String-9 != ' bar ') {
	test_fail
}

update request {
	&Tmp-String-1 := "%{substring:&Tmp-Integer-0 2 3}"
	&Tmp-String-2 := "%{substring:&Tmp-Integer-0 -3 3}"
	&Tmp-String-3 := "%{substring:&Tmp-Integer-0 1 -3}"
	&Tmp-String-4 := "%{substring:&Tmp-Integer-0 -4 -1}"
	&Tmp-String-5 := "%{substring:&Tmp-Integer-0 8 5}"
	&Tmp-String-6 := "%{substring:&Tmp-Integer-0 4 -10}"
	&Tmp-String-7 := "%{substring:&Tmp-Integer-0 0 8}"
	&Tmp-String-8 := "%{substring:&Tmp-Integer-0 5 0}"
	&Tmp-String-9 := "%{substring:&Tmp-Integer-0 4 10}"
}

if (&Tmp-String-1 != '786') {
	test_fail
}

if (&Tmp-String-2 != '512') {
	test_fail
}

if (&Tmp-String-3 != '4786') {
	test_fail
}

if (&Tmp-String-4 != '651') {
	test_fail
}

if (&Tmp-String-5 != '') {
	test_fail
}

if (&Tmp-String-6 != '') {
	test_fail
}

if (&Tmp-String-7 != '54786512') {
	test_fail
}

if (&Tmp-String-8 != '') {
	test_fail
}

if (&Tmp-String-9 != '6512') {
	test_fail
}

update request {
	&Tmp-String-1 := "%{substring:&Tmp-IP-Address-0 2 3}"
	&Tmp-String-2 := "%{substring:&Tmp-IP-Address-0 -3 3}"
	&Tmp-String-3 := "%{substring:&Tmp-IP-Address-0 1 -3}"
	&Tmp-String-4 := "%{substring:&Tmp-IP-Address-0 -4 -1}"
	&Tmp-String-5 := "%{substring:&Tmp-IP-Address-0 15 5}"
	&Tmp-String-6 := "%{substring:&Tmp-IP-Address-0 4 -20}"
	&Tmp-String-7 := "%{substring:&Tmp-IP-Address-0 0 13}"
	&Tmp-String-8 := "%{substring:&Tmp-IP-Address-0 6 0}"
	&Tmp-String-9 := "%{substring:&Tmp-IP-Address-0 8 12}"
}

if (&Tmp-String-1 != '2.1') {
	test_fail
}

if (&Tmp-String-2 != '.34') {
	test_fail
}

if (&Tmp-String-3 != '92.168.56') {
	test_fail
}

if (&Tmp-String-4 != '6.3') {
	test_fail
}

if (&Tmp-String-5 != '') {
	test_fail
}

if (&Tmp-String-6 != '') {
	test_fail
}

if (&Tmp-String-7 != '192.168.56.34') {
	test_fail
}

if (&Tmp-String-8 != '') {
	test_fail
}

if (&Tmp-String-9 != '56.34') {
	test_fail
}

update request {
	&Tmp-String-1 := "%{substring:&Tmp-Ethernet-0 2 3}"
	&Tmp-String-2 := "%{substring:&Tmp-Ethernet-0 -3 3}"
	&Tmp-String-3 := "%{substring:&Tmp-Ethernet-0 1 -3}"
	&Tmp-String-4 := "%{substring:&Tmp-Ethernet-0 -4 -1}"
	&Tmp-String-5 := "%{substring:&Tmp-Ethernet-0 20 5}"
	&Tmp-String-6 := "%{substring:&Tmp-Ethernet-0 4 -20}"
	&Tmp-String-7 := "%{substring:&Tmp-Ethernet-0 0 17}"
	&Tmp-String-8 := "%{substring:&Tmp-Ethernet-0 8 0}"
	&Tmp-String-9 := "%{substring:&Tmp-Ethernet-0 9 12}"
}

if (&Tmp-String-1 != ':23') {
	test_fail
}

if (&Tmp-String-2 != ':ab') {
	test_fail
}

if (&Tmp-String-3 != '1:23:45:67:89') {
	test_fail
}

if (&Tmp-String-4 != '9:a') {
	test_fail
}

if (&Tmp-String-5 != '') {
	test_fail
}

if (&Tmp-String-6 != '') {
	test_fail
}

if (&Tmp-String-7 != '01:23:45:67:89:ab') {
	test_fail
}

if (&Tmp-String-8 != '') {
	test_fail
}

if (&Tmp-String-9 != '67:89:ab') {
	test_fail
}

update request {
	&Tmp-String-1 := "%{substring:foo bar 2 3}"
	&Tmp-String-2 := "%{substring:foo bar -3 3}"
	&Tmp-String-3 := "%{substring:foo bar 1 -3}"
	&Tmp-String-4 := "%{substring:foo bar -4 -1}"
	&Tmp-String-5 := "%{substring:foo bar 8 5}"
	&Tmp-String-6 := "%{substring:foo bar 4 -10}"
	&Tmp-String-7 := "%{substring: foo bar  0 9}"
	&Tmp-String-8 := "%{substring: foo bar  5 0}"
	&Tmp-String-9 := "%{substring: foo bar  4 10}"
}

debug_request

if (&Tmp-String-1 != 'o b') {
	test_fail
}

if (&Tmp-String-2 != 'bar') {
	test_fail
}

if (&Tmp-String-3 != 'oo ') {
	test_fail
}

if (&Tmp-String-4 != ' ba') {
	test_fail
}

if (&Tmp-String-5 != '') {
	test_fail
}

if (&Tmp-String-6 != '') {
	test_fail
}

if (&Tmp-String-7 != ' foo bar ') {
	test_fail
}

if (&Tmp-String-8 != '') {
	test_fail
}

if (&Tmp-String-9 != ' bar ') {
	test_fail
}

success
