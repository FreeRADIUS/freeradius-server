#
# PRE:
#
&request.Tmp-String-1 := 'foo'
&request.Tmp-String-1 += 'bar'
&request.Tmp-Integer-0 := '4'
&request.Tmp-Integer-0 += '8'
&request.Tmp-Integer-0 += '1'

&request.Tmp-String-0 := '%{request.Tmp-String-1}'

#
#  Verify non string types are treated as literals
#
if ("%{eval:%{request.Tmp-Integer-0}}" != 4) {
	test_fail
}

if ("%{eval:%{request.Tmp-Integer-0[1]}}" != 8) {
	test_fail
}

#
#  Check double expansion works
#
if ("%{eval:%{request.Tmp-String-0}}" != 'foo') {
	test_fail
}

#
#  Using an attribute as a dynamic index for another attribute
#
if ("%{eval:\%{request.Tmp-String-1[%{request.Tmp-Integer-0[2]}]\}}" != 'bar') {
	test_fail
}

#
#  Check yielding works
#
if (<time_delta>"%(reschedule:)" > 1s) {
	test_fail
}

success
