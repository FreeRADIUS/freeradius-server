#
#  PRE: update update-remove-any if redundant
#

#
# Exec with script output to attribute
#
&request.Tmp-String-0 = `/bin/sh -c "echo 'foo bar baz'"`

if (!&request.Tmp-String-0 || (&request.Tmp-String-0 != "foo bar baz")) {
	test_fail
}

#
# Exec with output to list (single attribute)
#
&request = `/bin/sh -c "echo Tmp-String-0 := foo"`

if (!&request.Tmp-String-0 || (&request.Tmp-String-0 != 'foo')) {
	test_fail
}

#
# Exec with output to list (multiple attributes)
#
&request = `/bin/sh -c 'echo Tmp-String-0 := foo, Tmp-String-1 := bar'`

if (!&request.Tmp-String-0 || !&request.Tmp-String-1 || (&request.Tmp-String-0 != 'foo') || (&request.Tmp-String-1 != 'bar')) {
	test_fail
}

#
# Failed exec (malformed attributes) - check no attributes are added
#
&request.Tmp-String-0 !* ANY
&request.Tmp-String-1 !* ANY

redundant {
	group {
		&request = `/bin/sh -c 'echo Tmp-String-0 := foo, Tmp-String-1 ?= bar'`
	}
	ok
}
if (&request.Tmp-String-0 || &request.Tmp-String-1) {
	test_fail
}

#
# Exec with output to list - error code
#
&request.Tmp-String-0 !* ANY
&request.Tmp-String-1 !* ANY

redundant {
	group {
		&request = `/bin/sh -c 'echo Tmp-String-0 := foo; exit 64'`
	}
	ok
}
if (&request.Tmp-String-0) {
	test_fail
}

accept
success
