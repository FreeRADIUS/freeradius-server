mac-addr-regexp = '([0-9a-f]{2})[^0-9a-f]?([0-9a-f]{2})[^0-9a-f]?([0-9a-f]{2})[^0-9a-f]?([0-9a-f]{2})[^0-9a-f]?([0-9a-f]{2})[^0-9a-f]?([0-9a-f]{2})'

rewrite_called_station_id {
	if (Called-Station-Id && (Called-Station-Id =~ /^${policy.mac-addr-regexp}([^0-9a-f](.+))?$/i)) {
		request.Called-Station-Id := %str.upper("%{1}-%{2}-%{3}-%{4}-%{5}-%{6}")
		request.Called-Station-MAC := %bin("%{1}%{2}%{3}%{4}%{5}%{6}")
		if (%{8}) {
			request.Called-Station-SSID := %{8}
		}
		updated
	}
	else {
		noop
	}
}

